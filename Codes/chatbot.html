<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Career Guidance System</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Inter', sans-serif;
  background: linear-gradient(135deg, #f8f9fa, #e9ecef);
  overflow-x:hidden;
}

/* ===== COLLAPSIBLE SIDEBAR ===== */
.menu-icon{
  position:fixed;
  top:20px;
  left:20px;
  font-size:30px;
  cursor:pointer;
  color:#ff6b6b;
  z-index:1001;
}

.sidebar{
  position:fixed;
  top:0;
  left:-240px;
  width:240px;
  height:100vh;
  background: linear-gradient(90deg, #1a1a2e, #16213e);
  padding-top:80px;
  transition:0.4s;
  z-index:1000;
  color:white;
  display:flex;
  flex-direction:column;
}
.sidebar.active{left:0;}
.sidebar a{
  display:block;
  padding:18px 20px;
  color:white;
  text-decoration:none;
  font-weight:600;
}
.sidebar a:hover{background:#ff6b6b}

/* ===== RESULTS LAYOUT ===== */
#resultContainer{
  display:none;
  padding:20px;
  display:flex;
  flex-direction:row;
  gap:20px;
  margin-left:0; /* offset for sidebar handled in JS */
}
.cards-container{
  display:flex;
  flex-direction:column;
  gap:20px;
  flex-grow:1;
}
.card{
  background: #f8f9fa;
  padding:20px;
  border-radius:16px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
.card h3 {
  font-family: 'Playfair Display', serif;
  color: #343a40;
  margin-bottom: 1rem;
}
.card p {
  color: #495057;
}
#careerList {
  list-style: none;
  padding: 0;
}
#careerList li {
  color: #495057;
  margin-bottom: 0.5rem;
  font-weight: 500;
}
.bar-container{
  height:220px;
  display:flex;
  align-items:flex-end;
  justify-content:space-around;
}
.bar-item{text-align:center;width:70px;}
.bar{
  width:45px;
  background: linear-gradient(to top, #ff6b6b, #ffa500);
  border-radius:8px;
  margin:auto;
  position:relative;
}
.bar span{
  position:absolute;
  top:-24px;
  width:100%;
  font-weight:600;
  color: #343a40;
}
.skill-label{margin-top:10px;font-size:13px;}
.job-card{
  background: white;
  padding:12px;
  border-radius:10px;
  margin-bottom:10px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  color: #495057;
}
.job-card a {
  color: #ff6b6b;
  text-decoration: none;
}
.job-card a:hover {
  text-decoration: underline;
}

/* CHATBOX */
#chatContainer{
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.chatbox{
  background:#f7fbff;
  width:700px;
  padding:30px;
  border-radius:16px;
}
.section{color:#6a7df2;font-weight:600;margin-bottom:8px;}
.question{font-family: 'Playfair Display', serif; font-size:20px; margin-bottom:20px; color: #343a40;}
.option{
  width:100%;
  padding:12px;
  margin:10px 0;
  border:none;
  border-radius:50px;
  background: linear-gradient(45deg, #ff6b6b, #ffa500);
  color:white;
  cursor:pointer;
  transition: all 0.3s;
  box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
}
.option:hover{
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
}
</style>
</head>

<body>

<!-- MENU ICON -->
<div class="menu-icon" onclick="toggleMenu()">☰</div>

<!-- COLLAPSIBLE SIDEBAR -->
<div class="sidebar" id="sidebar">
  <a href="explore career.html">Explore Careers</a>
  <a href="soft_skills.html">Soft Skills</a>
  <a href="Degree_vs_demand.html">Degree Vs Demand</a>
  <a href="review.html">Review</a>
  <a href="#" onclick="restart()">Restart Quiz</a>
</div>

<!-- CHAT -->
<div id="chatContainer">
  <div class="chatbox">
    <div class="section" id="sectionTitle"></div>
    <div class="question" id="questionText"></div>
    <div id="options"></div>
  </div>
</div>

<!-- RESULTS -->
<div id="resultContainer">
  <div class="cards-container">
    <div class="card">
      <h3>Summary</h3>
      <p id="summary"></p>
    </div>

    <div class="card">
      <h3>Skill Strength (%)</h3>
      <div class="bar-container" id="barContainer"></div>
    </div>

    <div class="card">
      <h3>Skill Growth</h3>
      <canvas id="skillChart"></canvas>
    </div>

    <div class="card">
      <h3>Top Career Matches</h3>
      <ul id="careerList"></ul>
    </div>

    <div class="card">
      <h3>Suggested Jobs</h3>
      <div id="jobResults"></div>
    </div>

    <div class="card">
      <h3>Live Jobs</h3>
      <div id="liveJobs">Loading...</div>
    </div>
  </div>
</div>

<script>
/* ===== COLLAPSIBLE MENU ===== */
const sidebar = document.getElementById("sidebar");
function toggleMenu(){
  sidebar.classList.toggle("active");
}
function showMain(){
  // For this example, just collapse menu
  sidebar.classList.remove("active");
}

/* ===== QUESTIONS & RESULTS LOGIC ===== */
const questions = [
  {section:"Creative",skill:"Creativity",text:"I enjoy drawing, designing, or creating art."},
  {section:"Creative",skill:"Creativity",text:"I often come up with new ideas."},

  {section:"Social",skill:"Communication",text:"I enjoy helping people."},
  {section:"Social",skill:"Communication",text:"I like working in teams."},

  {section:"Technical",skill:"Technical",text:"I enjoy working with technology."},
  {section:"Technical",skill:"Technical",text:"I like fixing things."},

  {section:"Management",skill:"Leadership",text:"I enjoy leading a team."},
  {section:"Management",skill:"Leadership",text:"I can organize tasks well."},

  {section:"Analytical",skill:"Analysis",text:"I enjoy solving logical problems."},
  {section:"Analytical",skill:"Analysis",text:"I like working with data."}
];

let index = 0;
let scores = {};

/* JOB DATABASE */
const jobDatabase = {
  Creativity:["Graphic Designer","UI/UX Designer","Artist"],
  Communication:["Teacher","HR","Counselor"],
  Technical:["Software Engineer","Robotics Engineer","IT Specialist"],
  Leadership:["Project Manager","Team Lead","Business Manager"],
  Analysis:["Data Analyst","Economist","Researcher"]
};

/* MAPPING FOR LIVE JOB SEARCH */
const searchMap = {
  Creativity:"artist",
  Communication:"sales representative",
  Technical:"programmer",
  Leadership:"supervisor",
  Analysis:"accountant"
};

/* ===== LOAD QUESTION ===== */
function loadQuestion(){
  const q = questions[index];
  document.getElementById("sectionTitle").innerText = q.section;
  document.getElementById("questionText").innerText = q.text;

  const options = document.getElementById("options");
  options.innerHTML = "";
  [{t:"Yes",v:3},{t:"Sometimes",v:2},{t:"No",v:1}].forEach(o=>{
    const btn=document.createElement("button");
    btn.className="option";
    btn.innerText=o.t;
    btn.onclick=()=>answer(o.v);
    options.appendChild(btn);
  });
}

/* ===== HANDLE ANSWER ===== */
function answer(val){
  const skill = questions[index].skill;
  scores[skill] = (scores[skill] || 0) + val;
  index++;
  if(index >= questions.length) showResults();
  else loadQuestion();
}

/* ===== SHOW RESULTS ===== */
function showResults(){
  document.getElementById("chatContainer").style.display="none";
  document.getElementById("resultContainer").style.display="flex";

  const maxScore = 6;
  const percentages = {};
  for(let s in scores){
    percentages[s] = Math.round((scores[s]/maxScore)*100);
  }

  // Bars
  const barContainer = document.getElementById("barContainer");
  barContainer.innerHTML = "";
  Object.entries(percentages).forEach(([skill,val])=>{
    const div = document.createElement("div");
    div.className="bar-item";
    div.innerHTML = `
      <div class="bar" style="height:${val*2}px"><span>${val}%</span></div>
      <div class="skill-label">${skill}</div>
    `;
    barContainer.appendChild(div);
  });

  // Summary
  const topSkill = Object.entries(percentages).sort((a,b)=>b[1]-a[1])[0][0];
  document.getElementById("summary").innerText =
    `Your strongest aptitude is ${topSkill}. Careers related to this skill will suit you best.`;

  // Line Chart
  new Chart(document.getElementById("skillChart"),{
    type:"line",
    data:{
      labels:["Start","Mid","Current"],
      datasets:Object.entries(percentages).map(([skill,val])=>({
        label:skill,
        data:[20,50,val],
        borderWidth:2
      }))
    },
    options:{scales:{y:{min:0,max:100}}}
  });

  // Career List
  const list = document.getElementById("careerList");
  list.innerHTML = "";
  Object.entries(percentages).sort((a,b)=>b[1]-a[1]).forEach(([skill,val])=>{
    const li = document.createElement("li");
    li.innerText = `${jobDatabase[skill][0]} — ${val}%`;
    list.appendChild(li);
  });

  // Suggested Jobs
  const staticDiv = document.getElementById("jobResults");
  staticDiv.innerHTML = "";
  jobDatabase[topSkill].forEach(job=>{
    const d = document.createElement("div");
    d.className = "job-card";
    d.innerText = job;
    staticDiv.appendChild(d);
  });

  // Live/Nearby Jobs
  fetchLiveJobs(searchMap[topSkill]);
}

/* ===== FETCH LIVE JOBS ===== */
async function fetchLiveJobs(keyword){
  const container = document.getElementById("liveJobs");
  if(!container) return;

  console.log('Fetching jobs for keyword:', keyword);

  try {
    const res = await fetch(`http://localhost:3000/jobs?q=${keyword}&t=${Date.now()}`);
    let jobs = await res.json();
    jobs = jobs.sort(() => Math.random() - 0.5); // Shuffle jobs
    container.innerHTML = "";
    jobs.slice(0,5).forEach(job=>{
      const d = document.createElement("div");
      d.className = "job-card";
      d.innerHTML = `<strong>${job.title}</strong><br>${job.company||""}<br>${job.location||""}<br><a href="${job.url}" target="_blank">Apply</a>`;
      container.appendChild(d);
    });
  } catch(err){
    container.innerHTML = "⚠ Unable to load live jobs.";
  }
}

/* ===== RESTART QUIZ ===== */
function restart(){
  scores = {};
  index = 0;
  document.getElementById("resultContainer").style.display="none";
  document.getElementById("chatContainer").style.display="flex";
  loadQuestion();
}

/* ===== INIT ===== */
loadQuestion();
  </script>
  <script src="aiBot.js" defer></script>
  <script src="aiParticles.js" defer></script>

</body>
</html>
